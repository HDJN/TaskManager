
GO
/****** Object:  Table [dbo].[tu_Users]    Script Date: 06/14/2016 09:57:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[tu_Users](
	[UserId] [int] IDENTITY(1,1) NOT NULL,
	[UserName] [varchar](50) NOT NULL,
	[PassWord] [varchar](50) NOT NULL,
	[InsertTime] [datetime] NOT NULL,
	[RealName] [varchar](50) NOT NULL,
	[Status] [int] NOT NULL,
 CONSTRAINT [PK_tu_Users] PRIMARY KEY CLUSTERED 
(
	[UserId] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
SET IDENTITY_INSERT [dbo].[tu_Users] ON
INSERT [dbo].[tu_Users] ([UserId], [UserName], [PassWord], [InsertTime], [RealName], [Status]) VALUES (2, N'admin', N'123', CAST(0x0000A62400000000 AS DateTime), N'№ЬАн1', 1)
SET IDENTITY_INSERT [dbo].[tu_Users] OFF
/****** Object:  Table [dbo].[ts_Tasks]    Script Date: 06/14/2016 09:57:09 ******/


CREATE TABLE [dbo].[ts_Tasks](
	[Guid] [varchar](36) NOT NULL,
	[CreateUser] [int] NOT NULL,
	[Title] [nvarchar](50) NOT NULL,
	[ExecUrl] [varchar](200) NOT NULL,
	[ExecType] [int] NOT NULL,
	[Interval] [int] NOT NULL,
	[InsertTime] [datetime] NOT NULL,
	[Status] [int] NOT NULL,
	[IsResponseNorm] [bit] NOT NULL,
	[ExecMethod] [varchar](10) NULL,
	[TimeOut] [int] NOT NULL,
	[IsLogResult] [bit] NOT NULL,
	[Encoding] [varchar](50) NULL,
	[ExecParams] [varchar](200) NULL,
	[IsErrorAlert] [bit] NOT NULL,
	[ReceiveEmail] [varchar](200) NULL,
	[RunServerId] [int] NOT NULL,
 CONSTRAINT [PK_TaskInfo] PRIMARY KEY CLUSTERED 
(
	[Guid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]

GO

SET ANSI_PADDING OFF
GO

ALTER TABLE [dbo].[ts_Tasks] ADD  CONSTRAINT [DF_Tasks_InsertTime]  DEFAULT (getdate()) FOR [InsertTime]
GO

ALTER TABLE [dbo].[ts_Tasks] ADD  CONSTRAINT [DF_ts_Tasks_IsResponseNorm]  DEFAULT ((0)) FOR [IsResponseNorm]
GO



GO
CREATE TABLE [dbo].[ts_TaskExec](
	[TaskGuid] [varchar](36) NOT NULL,
	[LastExecTime] [datetime] NULL,
	[LastExecId] [int] NULL,
	[LastExecResultCode] [int] NULL,
 CONSTRAINT [PK_ts_TaskExec] PRIMARY KEY CLUSTERED 
(
	[TaskGuid] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO
SET ANSI_PADDING OFF
GO
/****** Object:  Table [dbo].[ts_ExecLog]    Script Date: 06/14/2016 09:57:09 ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ts_ExecLog](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[TaskGuid] [varchar](36) NOT NULL,
	[ExecStatrtTime] [datetime] NOT NULL,
	[ExecEndTime] [datetime] NOT NULL,
	[ExecResult] [varchar](max) NOT NULL,
	[ExecResultCode] [int] NOT NULL,
	[ExecUrl] [varchar](200) NOT NULL,
	[ExecParams] [varchar](200) NULL,
 CONSTRAINT [PK_ts_ExecLog] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]
GO

SET ANSI_NULLS ON
GO

SET QUOTED_IDENTIFIER ON
GO

SET ANSI_PADDING ON
GO
CREATE TABLE [dbo].[ts_Servers](
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[ServerName] [varchar](50) NOT NULL,
	[LastHeartTime] [datetime] NOT NULL,
	[IsEnable] [bit] NOT NULL,
	[ServerIP] [varchar](200) NULL,
	[IsMain] [bit] NOT NULL,
 CONSTRAINT [PK_ts_Servers] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)WITH (PAD_INDEX  = OFF, STATISTICS_NORECOMPUTE  = OFF, IGNORE_DUP_KEY = OFF, ALLOW_ROW_LOCKS  = ON, ALLOW_PAGE_LOCKS  = ON) ON [PRIMARY]
) ON [PRIMARY]


SET ANSI_PADDING OFF
GO

EXEC sys.sp_addextendedproperty @name=N'MS_Description', @value=N'ID' , @level0type=N'SCHEMA',@level0name=N'dbo', @level1type=N'TABLE',@level1name=N'ts_Servers', @level2type=N'COLUMN',@level2name=N'Id'
GO

ALTER TABLE [dbo].[ts_Servers] ADD  CONSTRAINT [DF_ts_Servers_IsEnable]  DEFAULT ((1)) FOR [IsEnable]
GO



 
 

declare @TbName varchar (50)
declare @sql varchar (5000)
Select @TbName='ts_ExecLog_'+CONVERT(char(6),  dateadd(month,1, GETDATE()) ,112) 	
IF  not EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(@TbName) AND type in (N'U'))
begin
set @sql='
CREATE TABLE [dbo].'+@TbName+'(
	[Id] [int] IDENTITY(1,1) NOT NULL,
	[TaskGuid] [varchar](36) NOT NULL,
	[ExecStatrtTime] [datetime] NOT NULL,
	[ExecEndTime] [datetime] NOT NULL,
	[ExecResult] [varchar](max) NOT NULL,
	[ExecResultCode] [int] NOT NULL,
	[ExecUrl] [varchar](200) NOT NULL,
	[ExecParams] [varchar](200) NULL,
 CONSTRAINT [PK_'+@TbName+'] PRIMARY KEY CLUSTERED 
(
	[Id] ASC
)
) ON [PRIMARY]
'

exec(@sql)
end
go